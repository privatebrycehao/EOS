{"ast":null,"code":"var _jsxFileName = \"/Users/bryce.hao/practics/eos/src/App.js\";\nimport React, { Component } from 'react';\nimport './App.css';\nimport { JsonRpc, RpcError } from 'eosjs';\nimport Tables from './containers/table';\nexport class App extends Component {\n  constructor() {\n    super();\n    this.state = {\n      last_block_id: '',\n      lastTenBlocks: [],\n      loading: false,\n      blockCount: 10\n    };\n    this.handleClick = this.handleClick.bind(this);\n  }\n\n  componentDidMount() {\n    this.getLatestBlock();\n  }\n\n  componentDidUpdate(nextProps, prevState) {\n    const {\n      last_block_id,\n      count\n    } = this.state;\n\n    if (prevState.last_block_id !== this.state.last_block_id) {\n      if (last_block_id - prevState.last_block_id >= count || prevState.last_block_id === '') {\n        const lastTenBlocks = [];\n        this.setState({\n          lastTenBlocks: []\n        });\n        this.getBlocks(last_block_id, lastTenBlocks);\n      } else {\n        let order = last_block_id - prevState.last_block_id;\n        const newBlocks = [];\n\n        while (order > -1) {\n          newBlocks.push(last_block_id - order);\n          order -= 1;\n        }\n\n        this.getBlocks(newBlocks);\n      }\n    }\n  }\n\n  handleClick() {\n    this.getLatestBlock();\n  }\n\n  async getLatestBlock() {\n    try {\n      const rpc = new JsonRpc('https://api.eosdetroit.io:443', 'Access-Control-Allow-Origin');\n      const response = await rpc.get_info();\n      this.setState({\n        last_block_id: response.head_block_num\n      });\n    } catch (e) {\n      console.log('\\nCaught exception: ' + e);\n      if (e instanceof RpcError) console.log(JSON.stringify(e.json, null, 2));\n    }\n  }\n\n  async getBlocks(latestBlock, existBlock = []) {\n    this.setState({\n      loading: true\n    });\n    let allBlocks = latestBlock;\n    let start = 0;\n\n    while (start < this.state.blockCount) {\n      const current = allBlocks - start;\n      const lastTenBlocks = existBlock;\n\n      try {\n        start += 1;\n        const rpc = new JsonRpc('https://api.eosdetroit.io:443');\n        const response = await rpc.get_block(current);\n        console.log('--------- start -------');\n        console.log(`${response.id} transactions will show below this line `);\n        console.log(response.transactions);\n        console.log('-------- end -------');\n        lastTenBlocks.push({\n          timestamp: response.timestamp.toString(),\n          blockId: response.id,\n          actions: response.transactions.length,\n          ...response\n        });\n        this.setState({\n          lastTenBlocks\n        });\n      } catch (e) {\n        console.log('\\nCaught exception: ' + e);\n        lastTenBlocks.push({\n          blockId: current\n        });\n        if (e instanceof RpcError) console.log(JSON.stringify(e.json, null, 2));\n      }\n    }\n\n    this.setState({\n      loading: false\n    });\n  }\n\n  get block() {\n    const {\n      last_block_id\n    } = this.state;\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 79,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 80,\n        columnNumber: 17\n      }\n    }, \"Look at the last block id below if available :\"), /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 81,\n        columnNumber: 17\n      }\n    }, last_block_id ? last_block_id : 'please wait to load latest block id'), /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 82,\n        columnNumber: 17\n      }\n    }, \" \", last_block_id ? `Waiting for loading block id from ${last_block_id - 9} to ${last_block_id}` : null), /*#__PURE__*/React.createElement(\"button\", {\n      className: \"retry\",\n      onClick: this.handleClick,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 83,\n        columnNumber: 17\n      }\n    }, \" Try to get latest data\"));\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"App\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 89,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"header\", {\n      className: \"App-header\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 90,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 91,\n        columnNumber: 17\n      }\n    }, this.block), /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 94,\n        columnNumber: 19\n      }\n    }, /*#__PURE__*/React.createElement(Tables, {\n      data: this.state.lastTenBlocks,\n      loading: this.state.loading,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 95,\n        columnNumber: 23\n      }\n    }))));\n  }\n\n}\nexport default App;","map":{"version":3,"sources":["/Users/bryce.hao/practics/eos/src/App.js"],"names":["React","Component","JsonRpc","RpcError","Tables","App","constructor","state","last_block_id","lastTenBlocks","loading","blockCount","handleClick","bind","componentDidMount","getLatestBlock","componentDidUpdate","nextProps","prevState","count","setState","getBlocks","order","newBlocks","push","rpc","response","get_info","head_block_num","e","console","log","JSON","stringify","json","latestBlock","existBlock","allBlocks","start","current","get_block","id","transactions","timestamp","toString","blockId","actions","length","block","render"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport './App.css';\nimport { JsonRpc, RpcError } from 'eosjs';\nimport Tables from './containers/table'\n\n\nexport class App extends Component {\n    constructor() {\n        super();\n        this.state = { last_block_id: '', lastTenBlocks: [], loading: false, blockCount: 10 };\n        this.handleClick = this.handleClick.bind(this);\n    }\n    componentDidMount() {\n        this.getLatestBlock();\n    }\n    componentDidUpdate(nextProps, prevState) {\n        const { last_block_id, count } = this.state;\n        if(prevState.last_block_id !== this.state.last_block_id) {\n            if (last_block_id - prevState.last_block_id >= count || prevState.last_block_id === '') {\n                const lastTenBlocks = [];\n                this.setState({lastTenBlocks: []});\n                this.getBlocks(last_block_id, lastTenBlocks);\n            } else {\n                let order = last_block_id - prevState.last_block_id;\n                const newBlocks = [];\n                while (order > -1) {\n                    newBlocks.push(last_block_id - order);\n                    order -= 1;\n                }\n                this.getBlocks(newBlocks)\n            }\n\n        }\n    }\n    handleClick() {\n        this.getLatestBlock();\n    }\n    async getLatestBlock() {\n        try{\n            const rpc = new JsonRpc('https://api.eosdetroit.io:443','Access-Control-Allow-Origin');\n            const response = await rpc.get_info();\n            this.setState({ last_block_id: response.head_block_num });\n        } catch (e) {\n            console.log('\\nCaught exception: ' + e);\n            if (e instanceof RpcError)\n                console.log(JSON.stringify(e.json, null, 2));\n        }\n    }\n    async getBlocks(latestBlock, existBlock = []) {\n            this.setState({loading: true});\n            let allBlocks = latestBlock;\n            let start = 0;\n            while(start < this.state.blockCount) {\n                const current = allBlocks - start;\n                const lastTenBlocks = existBlock;\n                try{\n                    start += 1;\n                    const rpc = new JsonRpc('https://api.eosdetroit.io:443');\n                    const response = await  rpc.get_block(current);\n                    console.log('--------- start -------');\n                    console.log(`${response.id} transactions will show below this line `);\n                    console.log(response.transactions);\n                    console.log('-------- end -------');\n                    lastTenBlocks.push({timestamp: response.timestamp.toString(), blockId: response.id, actions: response.transactions.length, ...response});\n                    this.setState({lastTenBlocks});\n                } catch (e) {\n                    console.log('\\nCaught exception: ' + e);\n                    lastTenBlocks.push({blockId: current});\n                    if (e instanceof RpcError)\n                        console.log(JSON.stringify(e.json, null, 2));\n                }\n            }\n        this.setState({loading: false});\n\n    }\n    get block() {\n        const { last_block_id } = this.state;\n        return (\n            <div>\n                <div>Look at the last block id below if available :</div>\n                <div>{last_block_id ? last_block_id : 'please wait to load latest block id'}</div>\n                <div> {last_block_id ? `Waiting for loading block id from ${last_block_id - 9} to ${last_block_id}` : null}</div>\n                <button className='retry' onClick={this.handleClick}> Try to get latest data</button>\n            </div>\n        )\n    }\n    render(){\n        return  (\n            <div className=\"App\">\n              <header className=\"App-header\">\n                <div>\n                    {this.block}\n                </div>\n                  <div>\n                      <Tables\n                          data={this.state.lastTenBlocks}\n                          loading={this.state.loading}\n                      >\n                      </Tables>\n                  </div>\n              </header>\n            </div>\n        );\n    }\n\n}\nexport default App;\n"]},"metadata":{},"sourceType":"module"}