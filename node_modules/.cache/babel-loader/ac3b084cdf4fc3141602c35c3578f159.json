{"ast":null,"code":"var _jsxFileName = \"/Users/bryce.hao/practics/eos/src/App.js\";\nimport React, { Component } from 'react';\nimport './App.css';\nimport { JsonRpc, RpcError } from 'eosjs';\nimport Tables from './containers/table';\nexport class App extends Component {\n  constructor() {\n    super();\n    this.state = {\n      last_block_id: '',\n      lastTenBlocks: [],\n      loading: false\n    };\n    this.handleClick = this.handleClick.bind(this);\n  }\n\n  componentDidMount() {\n    this.getLatestBlock();\n  }\n\n  componentDidUpdate(nextProps, prevState) {\n    if (prevState.last_block_id !== this.state.last_block_id) {\n      if (this.state.last_block_id - prevState.last_block_id > 9 || prevState.last_block_id === '') {\n        const lastTenBlocks = [];\n        this.setState({\n          lastTenBlocks: []\n        });\n        const blocks = this.state.last_block_id;\n        this.getBlocks(blocks, lastTenBlocks);\n      } else {\n        let order = this.state.last_block_id - prevState.last_block_id;\n        const newBlocks = [];\n\n        while (order > -1) {\n          newBlocks.push(this.state.last_block_id - order);\n          order -= 1;\n        }\n\n        this.getBlocks(newBlocks);\n      }\n    }\n  }\n\n  handleClick() {\n    this.getLatestBlock();\n  }\n\n  async getLatestBlock() {\n    try {\n      const rpc = new JsonRpc('https://api.eosdetroit.io:443', 'Access-Control-Allow-Origin');\n      const response = await rpc.get_info();\n      this.setState({\n        last_block_id: response.head_block_num\n      });\n    } catch (e) {\n      console.log('\\nCaught exception: ' + e);\n      if (e instanceof RpcError) console.log(JSON.stringify(e.json, null, 2));\n    }\n  }\n\n  async getBlocks(latestBlock, existBlock) {\n    this.setState({\n      loading: true\n    });\n    let allBlocks = latestBlock;\n    let start = 0;\n\n    while (start < 3) {\n      const current = allBlocks - start;\n      const lastTenBlocks = existBlock;\n\n      try {\n        start += 1;\n        const rpc = new JsonRpc('https://api.eosdetroit.io:443');\n        const response = await rpc.get_block(current);\n        console.log(response.transactions);\n        lastTenBlocks.push({\n          timestamp: response.timestamp.toString(),\n          blockId: response.id,\n          actions: response.transactions.length,\n          ...response\n        });\n        this.setState({\n          lastTenBlocks\n        });\n      } catch (e) {\n        console.log('\\nCaught exception: ' + e);\n        if (e instanceof RpcError) lastTenBlocks.push({\n          blockId: current\n        });\n        console.log(JSON.stringify(e.json, null, 2));\n      }\n    }\n\n    this.setState({\n      loading: false\n    });\n  }\n\n  get block() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 75,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 76,\n        columnNumber: 17\n      }\n    }, \"Look at the last block id below if available :\"), /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 77,\n        columnNumber: 17\n      }\n    }, this.state.last_block_id ? this.state.last_block_id : 'please wait to load latest block id'), /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 78,\n        columnNumber: 17\n      }\n    }, \" \", this.state.last_block_id ? `Waiting for loading block id from ${this.state.last_block_id - 9} to ${this.state.last_block_id}` : null), /*#__PURE__*/React.createElement(\"button\", {\n      className: \"retry\",\n      onClick: this.handleClick,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 79,\n        columnNumber: 17\n      }\n    }, \" Try to get latest data\"));\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"App\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 85,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"header\", {\n      className: \"App-header\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 86,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 87,\n        columnNumber: 17\n      }\n    }, this.block), /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 90,\n        columnNumber: 19\n      }\n    }, /*#__PURE__*/React.createElement(Tables, {\n      data: this.state.lastTenBlocks,\n      loading: this.state.loading,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 91,\n        columnNumber: 23\n      }\n    }))));\n  }\n\n}\nexport default App;","map":{"version":3,"sources":["/Users/bryce.hao/practics/eos/src/App.js"],"names":["React","Component","JsonRpc","RpcError","Tables","App","constructor","state","last_block_id","lastTenBlocks","loading","handleClick","bind","componentDidMount","getLatestBlock","componentDidUpdate","nextProps","prevState","setState","blocks","getBlocks","order","newBlocks","push","rpc","response","get_info","head_block_num","e","console","log","JSON","stringify","json","latestBlock","existBlock","allBlocks","start","current","get_block","transactions","timestamp","toString","blockId","id","actions","length","block","render"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport './App.css';\nimport { JsonRpc, RpcError } from 'eosjs';\nimport Tables from './containers/table'\n\n\nexport class App extends Component {\n    constructor() {\n        super();\n        this.state = { last_block_id: '', lastTenBlocks: [], loading: false };\n        this.handleClick = this.handleClick.bind(this);\n    }\n    componentDidMount() {\n        this.getLatestBlock();\n    }\n    componentDidUpdate(nextProps, prevState) {\n        if(prevState.last_block_id !== this.state.last_block_id) {\n            if (this.state.last_block_id - prevState.last_block_id > 9 || prevState.last_block_id === '') {\n                const lastTenBlocks = [];\n                this.setState({lastTenBlocks: []});\n                const blocks = this.state.last_block_id;\n                this.getBlocks(blocks, lastTenBlocks);\n            } else {\n                let order = this.state.last_block_id - prevState.last_block_id;\n                const newBlocks = [];\n                while (order > -1) {\n                    newBlocks.push(this.state.last_block_id - order);\n                    order -= 1;\n                }\n                this.getBlocks(newBlocks)\n            }\n\n        }\n    }\n    handleClick() {\n        this.getLatestBlock();\n    }\n    async getLatestBlock() {\n        try{\n            const rpc = new JsonRpc('https://api.eosdetroit.io:443','Access-Control-Allow-Origin');\n            const response = await rpc.get_info();\n            this.setState({ last_block_id: response.head_block_num });\n        } catch (e) {\n            console.log('\\nCaught exception: ' + e);\n            if (e instanceof RpcError)\n                console.log(JSON.stringify(e.json, null, 2));\n        }\n    }\n    async getBlocks(latestBlock, existBlock) {\n            this.setState({loading: true});\n            let allBlocks = latestBlock;\n            let start = 0;\n            while(start < 3) {\n                const current = allBlocks - start;\n                const lastTenBlocks = existBlock;\n                try{\n                    start += 1;\n                    const rpc = new JsonRpc('https://api.eosdetroit.io:443');\n                    const response = await  rpc.get_block(current);\n                    console.log(response.transactions);\n                    lastTenBlocks.push({timestamp: response.timestamp.toString(), blockId: response.id, actions: response.transactions.length, ...response});\n                    this.setState({lastTenBlocks});\n                } catch (e) {\n                    console.log('\\nCaught exception: ' + e);\n                    if (e instanceof RpcError)\n                        lastTenBlocks.push({blockId: current});\n                        console.log(JSON.stringify(e.json, null, 2));\n                }\n            }\n        this.setState({loading: false});\n\n    }\n    get block() {\n        return (\n            <div>\n                <div>Look at the last block id below if available :</div>\n                <div>{this.state.last_block_id ? this.state.last_block_id : 'please wait to load latest block id'}</div>\n                <div> {this.state.last_block_id ? `Waiting for loading block id from ${this.state.last_block_id - 9} to ${this.state.last_block_id}` : null}</div>\n                <button className='retry' onClick={this.handleClick}> Try to get latest data</button>\n            </div>\n        )\n    }\n    render(){\n        return  (\n            <div className=\"App\">\n              <header className=\"App-header\">\n                <div>\n                    {this.block}\n                </div>\n                  <div>\n                      <Tables\n                          data={this.state.lastTenBlocks}\n                          loading={this.state.loading}\n                      >\n                      </Tables>\n                  </div>\n              </header>\n            </div>\n        );\n    }\n\n}\nexport default App;\n"]},"metadata":{},"sourceType":"module"}